name: Deploy to GitLab

on:
    push:
        branches:
            - master

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2
      
            - name: Load environment variables from .env file
              run: |
                echo "GITLAB_TOKEN=$(grep GITLAB_TOKEN .env | cut -d '=' -f2-)" >> $GITHUB_ENV
      
            - name: Install GitLab CLI
              run: |
                curl -s https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash
                sudo apt-get install gitlab-runner

            - name: Configure GitLab CLI
              run: |
                git config --global user.name "@boletusam2gaming"
                git config --global user.email "ahmed.shiraz89@gmail.com"
                git remote add gitlab https://gitlab.com/officialproject/boletusam2-gaming-site.git
                git remote set-url gitlab https://oauth2:${{ env.GITLAB_TOKEN }}@gitlab.com/officialproject/boletusam2-gaming.git                
      
            - name: Deploy to GitLab
              env:
                GITLAB_TOKEN: ${{ env.GITLAB_TOKEN }}
              run: |
                git remote add gitlab https://gitlab.com/officialproject/boletusam2-gaming.git
                git push gitlab master